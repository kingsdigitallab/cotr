{% extends "base.html" %}
{% load staticfiles compress %}

{% block meta_title %}Side by side viewer integrated{% endblock %}

{% block custom_css %}
<link rel="stylesheet" type="text/x-scss" href="{% static 'scss/viewer.scss' %}">
{% endblock %}

{% block title %}
<h1 class="no-container">Side by side viewer</h1>
{% endblock %}

{% block main %}
{% verbatim %}

<div id="text-viewer" class="grid-x grid-margin-x">

    <div v-for="(block, block_index) in blocks" class="cell medium-6">
        <div class="off-canvas-wrapper">
            <div class="off-canvas-absolute position-left" :id="'offCanvas-'+block_index" data-off-canvas>
                <h3>Texts</h3>

                <h4>Work</h4>
                <!-- We do NOT link to Work at this stage -->
                <ul class="menu vertical">
                    <template v-for="text in texts">
                        <li v-if="text.type=='work'" :class="{selected: text == block.text} + ' text ' + text.type">
                            <span class="label secondary">{{ text.attributes.siglum }}</span> {{ text.attributes.name }}
                        </li>
                    </template>
                </ul>
                <!-- Versions and MSs -->
                <template v-for="text_type in text_types">
                    <h4>{{ text_type.label }}</h4>
                    <ul class="menu vertical">
                        <template v-for="text in texts">
                            <li v-if="text.type==text_type.type" :class="{selected: text == block.text} + ' text ' + text.type" @click="on_change_text(block, text)">
                                <a href="#"><span class="label secondary">{{ text.attributes.siglum }}</span> {{ text.attributes.name }}</a>
                            </li>
                        </template>
                    </ul>
                </template>
            </div>

            <div class="off-canvas-content" data-off-canvas-content>
                <div :class="['card block-view', block.text ? '' : 'empty']">
                    <div class="card-divider">
                        <div class="button-group">
                            <a class="button hollow arrow-only canvas-trigger" :data-toggle="'offCanvas-'+block_index">
                                <i class="fas fa-caret-right fa-2x"></i>
                                <span class="show-for-sr">List of texts</span>
                            </a>
                            <span v-if="block.text" class="label secondary">{{ block.text.attributes.siglum }}</span>
                            <h2>
                                <template v-if="block.text">
                                    {{ block.text.attributes.name }}
                                </template>
                                <template v-else>
                                    Select text
                                </template>
                            </h2>
                        </div>
                    </div>

                    <div v-if="block.text" v-for="view in block.views" :class="['card-section', block.text ? block.text.type : '']">

                        <div v-if="block.text" class="metadata">
                            <span class="label">{{ block.views[0].type|view_type_label }}</span>
                        </div>

                        <template v-if="view.status == 3">

                            <!-- show list of MS texts in a version -->
                            <ul v-if="block.text && block.text.type=='version'">
                                <template v-for="subtext in texts">
                                    <li v-if="subtext.attributes.group == block.text.id">
                                        {{ subtext.attributes.siglum }}: {{ subtext.attributes.name }}
                                    </li>
                                </template>
                            </ul>

                            <!-- html chunk -->
                            <div v-html="view.chunk"></div>
                        </template>

                        <template v-if="view.status < 3">
                            Loading content...
                        </template>
                        <template v-if="view.status == 4">
                            Error while loading content.
                        </template>
                    </div>

                    <a v-else class="card-section" :data-toggle="'offCanvas-'+block_index">
                        <span class="show-for-sr">Click to add another text</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
{% endblock %}

{% block footer_scripts %}
  <script src="{% static 'vue/dist/vue.js' %}"></script>

  <script src="{% static 'ctrs_texts/text_viewer.js' %}"></script>
{% endblock %}
