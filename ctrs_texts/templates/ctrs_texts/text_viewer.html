{% extends "base.html" %}
{% load staticfiles compress %}

{% block meta_title %}Side by side viewer{% endblock %}

{% block custom_css %}
<link rel="stylesheet" type="text/x-scss" href="{% static 'scss/digital-edition.scss' %}">
{% endblock %}

{% block title %}
<h1 class="no-container">Side by side viewer</h1>
{% endblock %}

{% block main %}
{% verbatim %}

<div id="text-viewer" class="grid-x grid-margin-x">

    <div v-for="(block, block_index) in blocks" class="cell medium-6">
        <div class="off-canvas-wrapper">
            <div class="off-canvas-absolute position-left" :id="'offCanvas-'+block_index" data-off-canvas>
                <h3>Texts</h3>

                <ul class="menu jump-menu">
                    <li>Jump to</li>
                    <li><a class="button secondary" :href="'#Work-'+block_index" title="Work">W</a></li>
                    <li><a class="button secondary" :href="'#Versions-'+block_index" title="Versions">V</a></li>
                    <li><a class="button secondary" :href="'#Manuscripts-'+block_index" title="Manuscripts">MS</a></li>
                </ul>

                <a :id="'Work-'+block_index"></a>
                <h4>Work</h4>
                <!-- We do NOT link to Work at this stage -->
                <ul class="menu vertical">
                    <template v-for="text in texts">
                        <li v-if="text.type=='work'" :class="{selected: text == block.text} + ' text ' + text.type">
                            <span class="label secondary">{{ text.attributes.siglum }}</span> {{ text.attributes.name }}
                        </li>
                    </template>
                </ul>
                <!-- Versions and MSs -->
                <template v-for="text_type in text_types">
                    <a :id="text_type.label+'-'+block_index"></a>
                    <h4>{{ text_type.label }}</h4>
                    <ul class="menu vertical">
                        <template v-for="text in texts">
                            <li v-if="text.type==text_type.type" :class="{selected: text == block.text} + ' text ' + text.type" @click="on_change_text(block, text)">
                                <a href="#" :data-toggle="'offCanvas-'+block_index"><span class="label secondary">{{ text.attributes.siglum }}</span>
                                  {{ text.attributes.name }}
                                  <span v-if="text.parent" class="label secondary version">{{ text.parent.attributes.siglum }}</span>
                                </a>
                            </li>
                        </template>
                    </ul>
                </template>
            </div>

            <div class="off-canvas-content" data-off-canvas-content>
                <div :class="['card block-view', block.text ? '' : 'empty']">
                    <div class="card-divider">
                        <div class="button-group">
                            <a class="button hollow arrow-only canvas-trigger" :data-toggle="'offCanvas-'+block_index">
                                <span class="show-for-sr">List of texts</span>
                            </a>
                            <span v-if="block.text" :class="'label secondary '+block.text.type">{{ block.text.attributes.siglum }}</span>
                            <h2>
                                <template v-if="block.text">
                                    {{ block.text.attributes.name }}
                                    <span v-if="block.text.parent" class="label secondary version nested">{{ block.text.parent.attributes.siglum }}</span>
                                </template>
                                <template v-else>
                                    Select text
                                </template>
                            </h2>
                        </div>
                    </div>

                    <div v-if="block.text" v-for="view in block.views" :class="['card-section', block.text ? block.text.type : '']">

                        <div v-if="block.text" class="metadata">
                            <div class="grid-x small-up-2">
                                <div class="cell">
                                    <button class="button hollow secondary show-content">
                                        <i class="fas fa-eye"></i>
                                        <span class="label secondary work">W</span>
                                        <span class="show-for-sr">Toggle Work unsettled regions borders</span>
                                    </button>
                                </div>
                                <div class="cell text-right">
                                    <template v-for="(type_label, type_key) in view_types">
                                        <button :class="{'button': 1, 'hollow': 1, 'active': type_key == view.type}" @click="change_view_type(block, view, type_key)">{{ type_label }}</button>&nbsp;
                                    </template>
                                </div>
                            </div>
                        </div>

                        <template v-if="view.status == 3">
                            <!-- show list of MS texts in a version -->
                            <ul v-if="block.text && block.text.type=='version'" class="group-members">
                                <template v-for="member in texts">
                                    <li v-if="member.attributes.group == block.text.id">
                                        <span class="label secondary">{{ member.attributes.siglum }}</span> {{ member.attributes.name }}
                                    </li>
                                </template>
                            </ul>

                            <!-- html chunk -->
                            <div v-html="view.chunk" :class="'text-display'"></div>
                        </template>

                        <template v-if="view.status < 3">
                            Loading content...
                        </template>
                        <template v-if="view.status == 4">
                            Error while loading content.
                        </template>
                    </div>

                    <a v-else class="card-section" :data-toggle="'offCanvas-'+block_index">
                        <i class="fas fa-plus-circle fa-2x"></i>
                        <span class="show-for-sr">Click to add another text</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
{% endblock %}

{% block footer_scripts %}
  <script src="{% static 'vue/dist/vue.js' %}"></script>

  <script src="{% static 'ctrs_texts/text_viewer.js' %}"></script>
{% endblock %}
